---
import Layout from "../../layouts/Layout.astro";
import ProductCard from "../../components/ProductCard.astro";
import { productsService } from "../../api/productsService.js";

let products = [];

try {
  const data = await productsService.getProducts();

  products = data.map((product: any) => {
    return {
      id: product.id,
      name: product.name,
      slug: product.slug,
      price: product.price.toString(),
      discount_price: product.discount_price
        ? product.discount_price.toString()
        : undefined,
      gallery: product.gallery || [],
      in_stock: product.in_stock,
      stock_quantity: product.stock_quantity,
      attributes: product.attributes || {},
    };
  });
} catch (error) {
  console.error("Error fetching products:", error);
  products = [];
}
---

<Layout title="Shop | Bablon">
  <section class="container mx-auto px-4 py-8">
    <div
      class="flex flex-col md:flex-row md:items-center md:justify-between mb-6"
    >
      <h2 class="text-2xl font-bold mb-4 md:mb-0">Products</h2>
    </div>

    <div
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
    >
      {products.map((product: any) => <ProductCard product={product} />)}
    </div>
  </section>
</Layout>
