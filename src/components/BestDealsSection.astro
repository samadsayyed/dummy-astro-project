---
import ProductCard from "./ProductCard.astro";

interface Product {
  id: number;
  name: string;
  slug: string;
  price: string;
  discount_price?: string;
  gallery?: string[];
  in_stock: boolean;
  stock_quantity: number;
  attributes?: Record<string, string>;
}

let products: Product[] = [];

try {
  const response = await fetch("https://admin.bablon.in/public/api/products");
  const allProducts = await response.json();
  // Filter products that have discounts and are in stock
  const discountedProducts = allProducts.filter((product: Product) => 
    product.discount_price && 
    parseFloat(product.discount_price) < parseFloat(product.price) &&
    product.in_stock && 
    product.stock_quantity > 0
  );
  products = discountedProducts.slice(0, 4); // Limit to 4 best deals
} catch (error) {
  console.error("Error fetching products:", error);
}
---

<section class="py-16 bg-gradient-to-br from-gray-50 to-white">
  <div class="max-w-7xl mx-auto px-4">
    <!-- Header Section -->
    <div class="text-center mb-12">
      <div class="inline-flex items-center space-x-2 px-4 py-2 bg-black text-white text-sm font-mono tracking-widest rounded-full mb-6">
        <span>BEST DEALS</span>
      </div>
      
      <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        <span class="block">Best Modern Furniture</span>
        <span class="block text-gray-600">Deals</span>
      </h2>
      
      <p class="text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed">
        Style Meets Savings. Redecorate without breaking the bank. Our bestsellers are now available at exclusive prices.
      </p>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
      {
        products.map((product: Product) => {
          if (!product) return null;
          return <ProductCard product={product} />;
        })
      }
    </div>

    <!-- CTA Section -->
    <div class="text-center">
      <a 
        href="/shop" 
        class="group inline-flex items-center px-8 py-4 bg-black text-white font-medium tracking-wider text-sm uppercase hover:bg-gray-800 transition-all duration-300 border-2 border-black hover:border-gray-800"
      >
        <span>Browse Bestsellers</span>
        <svg class="w-4 h-4 ml-3 group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  /* Smooth transitions */
  * {
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }
  
  /* Custom focus styles */
  a:focus {
    outline: 2px solid black;
    outline-offset: 2px;
  }
  
  /* Text selection */
  ::selection {
    background: rgba(0, 0, 0, 0.1);
    color: black;
  }
</style> 